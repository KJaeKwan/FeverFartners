{% extends 'base.html' %}

{% block content %}
  <div class="post-detail-body">
    <div class="header">
      <a href="{% url 'free_board:list' study_room_id %}"><i class="ri-arrow-drop-left-line back-arrow" style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); font-size: 3.5rem; cursor: pointer; color: white;"></i></a>
      <p style="font-weight: bold; margin-bottom: 0">자유게시판</p>
    </div>
    <div class="container">
      <!-- 사용자 오류 표시 -->
      {% if messages %}
      <div class="alert alert-danger my-3" role="alert">
        {% for message in messages %}
          <strong>{{ message.tags }}</strong>
          <ul><li>{{ message.message }}</li></ul>
        {% endfor %}
      </div>
      {% endif %}
      <h2 class="post-detail-title">{{ post.title }}</h2>
      <div class="post-body">
        <div class="post-info">
          <div class="post-author">
            {{ post.author.nickname }} |
          </div>
          <div class="post-created-time">
            {{ post.created_at|date:"y-m-d A g:i" }}
          </div>
          {% if post.updated_at %}
            <div class="post-update-time">
              <div>수정: </div>
              <div>{{ post.updated_at|date:"y-m-d A g:i" }}</div>
            </div>
          {% endif %}
        </div>
        <div class="post-writing">
          <div class="post-text">
            {{ post.content }}
          </div>
        </div>
      </div>
      <div class="post-vote">
          <div class="vote-count">
            {{ post.voter.count }}
          </div>
          <form action="{% url 'free_board:vote_post' study_room_id post.id %}" method="post" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="vote-button" onclick="return confirm('추천하시겠습니까?');"><i class="ri-heart-3-fill" style="color: red"></i></button>
          </form>
        </div>
      {% if request.user == post.author %}
      <div class="mod-del">
        <a href="{% url 'free_board:modify_post' study_room_id post.id %}" class="btn-mod">수정</a>
       <span class="separator">|</span>
        <form action="{% url 'free_board:post_delete' study_room_id post.id %}" method="post" style="display: inline;">
          {% csrf_token %}
          <input type="hidden" name="post_id" value="{{ post.id }}">
          <button type="submit" class="btn-del" onclick="return confirm('정말로 글을 삭제하시겠습니까?');">삭제</button>
        </form>
      </div>
      {% endif %}
      <hr class="custom-hr">
      <h5 class="comment-count">
        댓글({{ post.comments.count }})
      </h5>

      {% for comment in post.comments.all %}
        <div class="comment">
          <div class="comment-body">
            <div class="comment-author">
              <span>{{ comment.author.nickname }}</span>
              <div class="comment-author-details">
                작성 | {{ comment.created_at|date:"Y-m-d H:i" }}
                {% if comment.updated_at %}
                  수정 | {{ comment.updated_at|date:"Y-m-d H:i" }}
                {% endif %}
              </div>
            </div>
            <div class="comment-content">
              {{ comment.content }}
            </div>
          </div>

          {% if request.user == comment.author %}
            <div class="comment-mod-del-btn">
              <button type="button" onclick="location.href='{% url 'free_board:modify_comment' study_room_id comment.id %}'" class="btn-comment-action">수정</button>
              <form action="{% url 'free_board:comment_delete' study_room_id comment.id %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="btn-comment-action" onclick="return confirm('정말로 댓글을 삭제하시겠습니까?');">삭제</button>
              </form>
            </div>
          {% endif %}
        </div>
      {% endfor %}

      <form action="{% url 'free_board:create_comment' study_room_id post.id %}" method="post" class="my-3">
      {% csrf_token %}
      {% if form.errors %}
        <div class="alert alert-danger" role="alert">
          {% for field in form %}
            {% if field.errors %}
              <strong>{{ field.label }}</strong>
              {{ field.errors }}
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}
        <div class="comment-form">
          <textarea name="content" id="content" {% if not user.is_authenticated %} disabled {% endif %} cols="30" rows="10"></textarea>
          <input type="submit" value="댓글 등록" class="btn-submit-comment">
        </div>
      </form>
      <a href="{% url 'free_board:list' study_room_id %}" class="btn-return-list">목록</a>
    </div>
  </div>
  <footer class="footer">
    <div class="footer-container">
      <a href="#" class="footer-link" style="display: flex;">
        <div class="footer-item">
          <i class="ri-group-fill footer-icon" style="font-size: 30px; color: #db4455; margin-bottom: 10px; margin-left: 10px"></i>
          <div class="footer-text" style="color: #db4455; font-size: 16px; font-style: italic;">Group</div>
        </div>
      </a>
      <a href="#" class="footer-link" style="display: flex">
        <div class="footer-item">
          <i class="ri-focus-2-line footer-icon" style="font-size: 30px; color: #db4455; margin-bottom: 10px; margin-left: 14px"></i>
          <div class="footer-text" style="color: #db4455; font-size: 16px; font-style: italic;">MyGoal</div>
        </div>
      </a>
      <a href="#" class="footer-link" style="display: flex;">
        <div class="footer-item">
          <i class="ri-file-list-3-line footer-icon" style="font-size: 30px; color: #db4455; margin-bottom: 10px;"></i>
          <div class="footer-text" style="color: #db4455; font-size: 16px; font-style: italic;">null</div>
        </div>
      </a>
    </div>
  </footer>
{% endblock %}
