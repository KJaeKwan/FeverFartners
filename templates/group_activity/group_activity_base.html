{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{%static 'css/reset.css' %}" />
    <link rel="stylesheet" href="{%static 'css/jk.css' %}" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/aa0228ade6.js" crossorigin="anonymous"></script>
    <script src="{%static 'javascript/main.js'%}" defer></script>
    <script src="{%static 'javascript/jk.js'%}" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10" defer></script>
    <title>그룹 활동 페이지</title>
    <style></style>
  </head>
  <body>
    <div id="group-introbox">
      <div id="group-intro-text">
        <p class="white-title">{{ room.title }}</p>
        <div class="group-intro-tag">
          {% for tag in room.tags.all %}
          <p>#{{ tag }}</p>
          {% endfor %}
        </div>
        <p>{{ room.detail }}</p>
      </div>
      <div id="group-admin-or-withdraw">
        <a
          href="{%url 'group_administration:group_admin_main' room_id%}"
          onclick="PermissionCheck({{user.pk}}, {{room_id}})"
          class="group-btn"
          >그룹 관리</a
        >
        <a 
          onclick="WithdrawalConfirm({{user.pk}}, {{room_id}})"
          class="group-btn"
          >탈퇴하기</a>
      </div>
    </div>
    <div id="group-select-activity-list">
      <a href="{%url 'group_activity:member_list' room_id%}" onclick="changeTab('member', event)">멤버</a>
      <a href="{% url 'group_activity:activate' room_id %}" onclick="changeTab('activate', event)">인증 공간</a>
      <a href="{% url 'group_activity:show_log' room_id %}" onclick="changeTab('show_log', event)">활동 현황</a>
      <a href="{% url 'free_board:list' room_id %}">게시판</a>
    </div>
    <div id="group-activity-content">
      {% block content %} {% endblock content %}
    </div>
    <div class="footer">
      <a href="#" class="footer-link" style="display: flex;">
        <div class="footer-item">
          <i class="fa-solid fa-user-group footer-icon"></i>
          <div class="footer-text">Group</div>
        </div>
      </a>
      <a href="#" class="footer-link" style="display: flex;">
        <div class="footer-item">
          <i class="fa-solid fa-bullseye footer-icon"></i>
          <div class="footer-text">MyGoal</div>
        </div>
      </a>
      <a href="#" class="footer-link" style="display: flex;">
        <div class="footer-item">
          <i class="ri-file-list-3-line footer-icon"></i>
          <div class="footer-text">null</div>     <!-- 이 부분 이름은 나중에 수정 필요 -->
        </div>
      </a>
    </div>
  </body>
  <script>
    function loadContent(url) {
      fetch(url)
          .then(response => {
              if (!response.ok) {
                  throw new Error('Network response was not ok');
              }
              return response.text();
          })
          .then(data => {
              document.getElementById('group-activity-content').innerHTML = data;
          })
          .catch(error => {
              console.error('Error during fetch operation:', error);
          });
    }

    function changeTab(tab, event) {
        event.preventDefault();

        // 모든 링크에서 selected 클래스 제거
        var links = document.querySelectorAll('#group-select-activity-list a');
        links.forEach(function(link) {
          link.classList.remove('selected-group-tab');
        });
      
        // 클릭한 링크에 selected 클래스 추가
        var selectedLink = event.currentTarget;
        selectedLink.classList.add('selected-group-tab');


        var url = '';
        switch (tab) {
          case 'member':
              url = "{% url 'group_activity:member_list' room_id %}";
              break;
          case 'activate':
              url = "{% url 'group_activity:activate' room_id %}";
              break;
          case 'show_log':
              url = "{% url 'group_activity:show_log' room_id %}";
              break;
        }
        loadContent(url);
    }
  </script>
</html>
